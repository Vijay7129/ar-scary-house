<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0"/>
  <title>AR Scary House</title>
  
  <!-- Model Viewer - Google's AR/3D viewer -->
  <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.4.0/model-viewer.min.js"></script>
  
  <style>
    body,html{height:100%;margin:0;background:#000;color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;overflow:hidden;}
    
    .container {height:100%;display:flex;flex-direction:column;}
    
    .header {padding:16px;text-align:center;background:linear-gradient(180deg, rgba(20,0,0,0.95), rgba(0,0,0,0.85));box-shadow:0 2px 12px rgba(255,0,0,0.3);z-index:10;}
    
    h1 {margin:0 0 8px;font-size:1.8em;background:linear-gradient(135deg,#ff0000,#ff6600);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
    
    .subtitle {font-size:0.9em;opacity:0.85;margin:0;}
    
    model-viewer {
      width:100%;
      height:100%;
      flex:1;
      background-color:#000;
      --poster-color:#000;
      --progress-bar-color:#ff0000;
    }
    
    .controls {
      position:fixed;
      bottom:20px;
      left:50%;
      transform:translateX(-50%);
      display:flex;
      flex-direction:column;
      gap:12px;
      z-index:100;
      align-items:center;
      max-width:90%;
    }
    
    .btn-row {display:flex;gap:12px;flex-wrap:wrap;justify-content:center;}
    
    button {
      padding:14px 24px;
      border-radius:10px;
      border:0;
      background:linear-gradient(135deg,#ff0000,#cc0000);
      color:#fff;
      font-weight:700;
      font-size:1em;
      box-shadow:0 4px 16px rgba(255,0,0,0.5);
      cursor:pointer;
      transition:all 0.3s;
      white-space:nowrap;
    }
    
    button:active {transform:scale(0.95);}
    
    .secondary {background:linear-gradient(135deg,#333,#111)!important;box-shadow:0 4px 16px rgba(0,0,0,0.6)!important;}
    
    .ar-button {
      background:linear-gradient(135deg,#00ff00,#00cc00)!important;
      box-shadow:0 4px 16px rgba(0,255,0,0.5)!important;
      font-size:1.2em;
      padding:18px 32px;
      animation:pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% {box-shadow:0 4px 16px rgba(0,255,0,0.5);}
      50% {box-shadow:0 4px 24px rgba(0,255,0,0.8);}
    }
    
    .status {
      background:rgba(0,0,0,0.8);
      padding:8px 16px;
      border-radius:20px;
      font-size:0.85em;
      border:1px solid rgba(255,255,255,0.2);
    }
    
    .status.active {
      border-color:#00ff00;
      color:#00ff00;
    }
    
    .instructions {
      position:fixed;
      top:50%;
      left:50%;
      transform:translate(-50%, -50%);
      background:rgba(0,0,0,0.95);
      padding:24px;
      border-radius:12px;
      border:2px solid #ff0000;
      max-width:90%;
      width:400px;
      z-index:200;
      display:none;
    }
    
    .instructions.show {display:block;}
    
    .instructions h2 {margin:0 0 16px;color:#ff0000;}
    
    .instructions ol {margin:12px 0;padding-left:24px;line-height:1.8;text-align:left;}
    
    .instructions button {width:100%;margin-top:16px;}
    
    .warning-box {
      background:rgba(255,0,0,0.1);
      border:1px solid rgba(255,0,0,0.3);
      padding:12px;
      border-radius:8px;
      margin-top:12px;
      font-size:0.85em;
      line-height:1.4;
    }
    
    @keyframes shake {
      0%, 100% {transform:translate(-50%, -50%) rotate(0deg);}
      25% {transform:translate(-50%, -50%) rotate(-5deg);}
      75% {transform:translate(-50%, -50%) rotate(5deg);}
    }
    
    .shake {animation:shake 0.3s ease-in-out 3;}

    .loading {
      position:absolute;
      top:50%;
      left:50%;
      transform:translate(-50%, -50%);
      font-size:1.2em;
      z-index:5;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üèöÔ∏è AR Scary House</h1>
      <div class="subtitle">Tap "View in AR" to place the haunted house in your space</div>
    </div>

    <!-- Model Viewer with AR support - Using a public haunted house model -->
    <model-viewer
      id="viewer"
      src="https://modelviewer.dev/shared-assets/models/glTF-Sample-Assets/Models/HauntedHouse/glTF-Binary/HauntedHouse.glb"
      alt="Scary haunted house 3D model"
      ar
      ar-modes="webxr scene-viewer quick-look"
      camera-controls
      touch-action="pan-y"
      shadow-intensity="1.5"
      exposure="0.8"
      shadow-softness="0.5"
      auto-rotate
      auto-rotate-delay="2000"
      rotation-per-second="20deg"
      camera-orbit="0deg 75deg 8m"
      min-camera-orbit="auto auto 3m"
      max-camera-orbit="auto auto 15m"
      loading="eager"
    >
      <!-- AR Button (automatically appears on supported devices) -->
      <button slot="ar-button" class="ar-button" id="arButton">
        üëª View in AR
      </button>
      
      <div class="loading" slot="poster">Loading haunted house... üèöÔ∏è</div>
    </model-viewer>

    <div class="controls">
      <div id="status" class="status">Audio: Off | Rotate to explore</div>
      <div class="btn-row">
        <button id="audioBtn" class="secondary">üîä Enable Audio</button>
        <button id="scareBtn" class="secondary">üò± Jumpscare</button>
        <button id="helpBtn" class="secondary">‚ùì Help</button>
      </div>
    </div>

    <div class="instructions" id="instructions">
      <h2>üì± How to Use AR</h2>
      <ol>
        <li><strong>Enable Audio First</strong> - Tap the üîä button</li>
        <li><strong>Tap "View in AR"</strong> - The big green button</li>
        <li><strong>Grant Camera Permission</strong> - When browser asks</li>
        <li><strong>Point at Floor/Ground</strong> - Move phone slowly to scan</li>
        <li><strong>Tap Screen to Place</strong> - Position the scary house</li>
        <li><strong>Walk Around It</strong> - Get close and explore!</li>
      </ol>
      <div class="warning-box">
        ‚ö†Ô∏è <strong>AR Requirements:</strong><br>
        ‚Ä¢ iOS 12+ with Safari, or<br>
        ‚Ä¢ Android 8+ with Chrome<br>
        ‚Ä¢ Good lighting helps AR tracking
      </div>
      <button onclick="document.getElementById('instructions').classList.remove('show')">
        Got It! üëç
      </button>
    </div>
  </div>

  <!-- Audio files -->
  <audio id="amb" loop src="haunted-house-ambience-337104.mp3"></audio>
  <audio id="scream" src="794212__aksiny_soundeditor__monster-scream-2.wav"></audio>

  <script>
    const viewer = document.getElementById('viewer');
    const audioBtn = document.getElementById('audioBtn');
    const scareBtn = document.getElementById('scareBtn');
    const helpBtn = document.getElementById('helpBtn');
    const status = document.getElementById('status');
    const instructions = document.getElementById('instructions');
    const amb = document.getElementById('amb');
    const scream = document.getElementById('scream');

    let audioEnabled = false;
    let modelLoaded = false;

    // Show instructions on first visit
    let isFirstVisit = true;
    try {
      isFirstVisit = !localStorage.getItem('visited');
    } catch(e) {
      // LocalStorage not available, assume first visit
    }

    if (isFirstVisit) {
      setTimeout(() => {
        instructions.classList.add('show');
        try {
          localStorage.setItem('visited', 'true');
        } catch(e) {}
      }, 1500);
    }

    // Model loading status
    viewer.addEventListener('load', () => {
      modelLoaded = true;
      status.textContent = 'Model Loaded! Tap AR button ‚Üì';
      status.style.borderColor = '#00ff00';
      console.log('3D model loaded successfully');
    });

    viewer.addEventListener('error', (event) => {
      console.error('Model loading error:', event);
      status.textContent = 'Error loading model';
      status.style.borderColor = '#ff0000';
    });

    // Enable audio
    audioBtn.addEventListener('click', async () => {
      try {
        amb.volume = 0.6;
        await amb.play();
        audioEnabled = true;
        audioBtn.textContent = '‚úì Audio On';
        audioBtn.style.background = 'linear-gradient(135deg,#00cc00,#008800)';
        updateStatus();
      } catch(e) {
        console.warn('Audio blocked:', e);
        audioBtn.textContent = '‚ö†Ô∏è Tap Again';
      }
    });

    // Help button
    helpBtn.addEventListener('click', () => {
      instructions.classList.add('show');
    });

    // Jumpscare button
    scareBtn.addEventListener('click', () => {
      triggerJumpscare();
    });

    function triggerJumpscare() {
      scream.currentTime = 0;
      scream.volume = 0.8;
      scream.play();
      document.body.style.background = '#ff0000';
      if (instructions.classList.contains('show')) {
        instructions.classList.add('shake');
      }
      setTimeout(() => {
        document.body.style.background = '#000';
        instructions.classList.remove('shake');
      }, 300);
    }

    function updateStatus() {
      let statusText = '';
      if (audioEnabled) {
        statusText = 'Audio: On';
      } else {
        statusText = 'Audio: Off';
      }
      
      if (modelLoaded) {
        statusText += ' | Tap AR button below ‚Üì';
      }
      
      status.textContent = statusText;
    }

    // Random ambient jumpscares
    let lastScare = 0;
    setInterval(() => {
      const now = Date.now();
      if (audioEnabled && now - lastScare > 20000 && Math.random() < 0.08) {
        lastScare = now;
        triggerJumpscare();
      }
    }, 5000);

    // AR session tracking
    viewer.addEventListener('ar-status', (event) => {
      console.log('AR Status:', event.detail.status);
      if (event.detail.status === 'session-started') {
        status.textContent = 'üëª AR Active! Place the house';
        status.style.borderColor = '#00ff00';
        status.classList.add('active');
      } else if (event.detail.status === 'not-presenting') {
        updateStatus();
        status.classList.remove('active');
      }
    });

    // Touch interaction for immersion
    let touchCount = 0;
    viewer.addEventListener('touchstart', () => {
      touchCount++;
      if (touchCount > 8 && audioEnabled && Math.random() < 0.2) {
        triggerJumpscare();
        touchCount = 0;
      }
    });

    // Check AR support
    if (viewer.canActivateAR) {
      console.log('AR is supported on this device!');
    } else {
      console.warn('AR may not be supported on this device');
      setTimeout(() => {
        status.textContent = 'AR may not work on this device';
        status.style.borderColor = '#ff9900';
      }, 3000);
    }
  </script>
</body>
</html>
