<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0"/>
  <title>AR Scary House</title>
  
  <!-- Model Viewer - Google's AR/3D viewer -->
  <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.4.0/model-viewer.min.js"></script>
  
  <style>
    body,html{height:100%;margin:0;background:#000;color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;overflow:hidden;}
    
    .container {height:100%;display:flex;flex-direction:column;}
    
    .header {padding:16px;text-align:center;background:linear-gradient(180deg, rgba(20,0,0,0.95), rgba(0,0,0,0.85));box-shadow:0 2px 12px rgba(255,0,0,0.3);z-index:10;}
    
    h1 {margin:0 0 8px;font-size:1.8em;background:linear-gradient(135deg,#ff0000,#ff6600);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
    
    .subtitle {font-size:0.9em;opacity:0.85;margin:0;}
    
    model-viewer {
      width:100%;
      height:100%;
      flex:1;
      background-color:#000;
      --poster-color:#000;
      --progress-bar-color:#ff0000;
    }
    
    .controls {
      position:fixed;
      bottom:20px;
      left:50%;
      transform:translateX(-50%);
      display:flex;
      flex-direction:column;
      gap:12px;
      z-index:100;
      align-items:center;
    }
    
    .btn-row {display:flex;gap:12px;}
    
    button {
      padding:14px 24px;
      border-radius:10px;
      border:0;
      background:linear-gradient(135deg,#ff0000,#cc0000);
      color:#fff;
      font-weight:700;
      font-size:1em;
      box-shadow:0 4px 16px rgba(255,0,0,0.5);
      cursor:pointer;
      transition:all 0.3s;
      white-space:nowrap;
    }
    
    button:active {transform:scale(0.95);}
    
    .secondary {background:linear-gradient(135deg,#333,#111)!important;box-shadow:0 4px 16px rgba(0,0,0,0.6)!important;}
    
    .ar-button {
      background:linear-gradient(135deg,#00ff00,#00cc00)!important;
      box-shadow:0 4px 16px rgba(0,255,0,0.5)!important;
      font-size:1.1em;
      animation:pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% {box-shadow:0 4px 16px rgba(0,255,0,0.5);}
      50% {box-shadow:0 4px 24px rgba(0,255,0,0.8);}
    }
    
    .status {
      background:rgba(0,0,0,0.8);
      padding:8px 16px;
      border-radius:20px;
      font-size:0.85em;
      border:1px solid rgba(255,255,255,0.2);
    }
    
    .status.active {
      border-color:#00ff00;
      color:#00ff00;
    }
    
    .instructions {
      position:fixed;
      top:50%;
      left:50%;
      transform:translate(-50%, -50%);
      background:rgba(0,0,0,0.95);
      padding:24px;
      border-radius:12px;
      border:2px solid #ff0000;
      max-width:90%;
      width:400px;
      z-index:200;
      display:none;
    }
    
    .instructions.show {display:block;}
    
    .instructions h2 {margin:0 0 16px;color:#ff0000;}
    
    .instructions ol {margin:12px 0;padding-left:24px;line-height:1.8;}
    
    .instructions button {width:100%;margin-top:16px;}
    
    @keyframes shake {
      0%, 100% {transform:translate(-50%, -50%) rotate(0deg);}
      25% {transform:translate(-50%, -50%) rotate(-5deg);}
      75% {transform:translate(-50%, -50%) rotate(5deg);}
    }
    
    .shake {animation:shake 0.3s ease-in-out 3;}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üèöÔ∏è AR Scary House</h1>
      <div class="subtitle">Tap "View in AR" to place the haunted house in your space</div>
    </div>

    <!-- Model Viewer with AR support -->
    <model-viewer
      id="viewer"
      src="scary-house.glb"
      alt="Scary haunted house 3D model"
      ar
      ar-modes="webxr scene-viewer quick-look"
      camera-controls
      touch-action="pan-y"
      shadow-intensity="1"
      exposure="1"
      environment-image="neutral"
      auto-rotate
      auto-rotate-delay="1000"
      rotation-per-second="30deg"
    >
      <!-- AR Button (automatically appears on supported devices) -->
      <button slot="ar-button" class="ar-button" id="arButton">
        üëª View in AR
      </button>
    </model-viewer>

    <div class="controls">
      <div id="status" class="status">Audio: Off</div>
      <div class="btn-row">
        <button id="audioBtn" class="secondary">üîä Enable Audio</button>
        <button id="scareBtn" class="secondary">üò± Jumpscare</button>
      </div>
    </div>

    <div class="instructions" id="instructions">
      <h2>üì± First Time Setup</h2>
      <ol>
        <li><strong>Enable Audio</strong> - Tap the audio button below</li>
        <li><strong>Grant Permissions</strong> - Allow camera access when prompted</li>
        <li><strong>Tap "View in AR"</strong> - The green button</li>
        <li><strong>Point at Floor</strong> - Move phone to scan surface</li>
        <li><strong>Tap to Place</strong> - Position the house</li>
        <li><strong>Walk Around</strong> - Get close and explore!</li>
      </ol>
      <button onclick="document.getElementById('instructions').classList.remove('show')">
        Got It! üëç
      </button>
    </div>
  </div>

  <!-- Audio files -->
  <audio id="amb" loop src="haunted-house-ambience-337104.mp3"></audio>
  <audio id="scream" src="794212__aksiny_soundeditor__monster-scream-2.wav"></audio>

  <script>
    const viewer = document.getElementById('viewer');
    const audioBtn = document.getElementById('audioBtn');
    const scareBtn = document.getElementById('scareBtn');
    const status = document.getElementById('status');
    const instructions = document.getElementById('instructions');
    const amb = document.getElementById('amb');
    const scream = document.getElementById('scream');

    let audioEnabled = false;
    let isFirstVisit = !localStorage.getItem('visited');

    // Show instructions on first visit
    if (isFirstVisit) {
      setTimeout(() => {
        instructions.classList.add('show');
        localStorage.setItem('visited', 'true');
      }, 1000);
    }

    // Enable audio
    audioBtn.addEventListener('click', async () => {
      try {
        await amb.play();
        audioEnabled = true;
        audioBtn.textContent = '‚úì Audio On';
        audioBtn.style.background = 'linear-gradient(135deg,#00cc00,#008800)';
        status.textContent = 'Audio: On';
        status.classList.add('active');
      } catch(e) {
        console.warn('Audio blocked:', e);
        audioBtn.textContent = '‚ö†Ô∏è Tap Again';
      }
    });

    // Jumpscare button
    scareBtn.addEventListener('click', () => {
      triggerJumpscare();
    });

    function triggerJumpscare() {
      scream.currentTime = 0;
      scream.play();
      document.body.style.background = '#ff0000';
      instructions.classList.add('shake');
      setTimeout(() => {
        document.body.style.background = '#000';
        instructions.classList.remove('shake');
      }, 300);
    }

    // Random ambient jumpscares
    let lastScare = 0;
    setInterval(() => {
      const now = Date.now();
      if (audioEnabled && now - lastScare > 15000 && Math.random() < 0.1) {
        lastScare = now;
        triggerJumpscare();
      }
    }, 5000);

    // AR session tracking
    viewer.addEventListener('ar-status', (event) => {
      if (event.detail.status === 'session-started') {
        status.textContent = 'üëª AR Active!';
        status.style.borderColor = '#00ff00';
      } else if (event.detail.status === 'not-presenting') {
        status.textContent = 'Audio: ' + (audioEnabled ? 'On' : 'Off');
      }
    });

    // Touch interaction for immersion
    let touchCount = 0;
    viewer.addEventListener('touchstart', () => {
      touchCount++;
      if (touchCount > 5 && Math.random() < 0.15) {
        triggerJumpscare();
        touchCount = 0;
      }
    });
  </script>
</body>
</html>
